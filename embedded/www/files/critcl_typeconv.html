
<html><head>
<title>critcl::typeconv - C Runtime In Tcl (CriTcl)</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'critcl_typeconv.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2011-2012 Andreas Kupries
   -->
<! -- CVS: $Id$ critcl::typeconv.n
   -->
<body><div class="doctools">
<hr> [
   <a href="../toc.html">Table Of Contents</a>
| <a href="../index.html">Keyword Index</a>
 ] <hr>
<h1 class="title">critcl::typeconv(n) 1 doc &quot;C Runtime In Tcl (CriTcl)&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>critcl::typeconv - CriTcl Type Management</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">API</a></li>
<li class="section"><a href="#section3">Authors</a></li>
<li class="section"><a href="#section4">Bugs, Ideas, Feedback</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
<li class="section"><a href="#category">Category</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">Tcl 8.4</b></li>
<li>package require <b class="pkgname">critcl <span class="opt">?3?</span></b></li>
<li>package require <b class="pkgname">critcl::typeconv <span class="opt">?1?</span></b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="cmd">::critcl::typeconv::arg-def</b> <i class="arg">name</i> <i class="arg">body</i> <span class="opt">?<i class="arg">ctype</i>?</span> <span class="opt">?<i class="arg">ctypefun</i>?</span></a></li>
<li><a href="#2"><b class="cmd">::critcl::typeconv::arg-def</b> <i class="arg">name</i> <b class="method">=</b> <i class="arg">origname</i></a></li>
<li><a href="#3"><b class="cmd">::critcl::typeconv::arg-set-support</b> <i class="arg">name</i> <i class="arg">code</i></a></li>
<li><a href="#4"><b class="cmd">::critcl::typeconv::arg-get-var-type</b> <i class="arg">name</i></a></li>
<li><a href="#5"><b class="cmd">::critcl::typeconv::arg-get-arg-type</b> <i class="arg">name</i></a></li>
<li><a href="#6"><b class="cmd">::critcl::typeconv::arg-get-conv</b> <i class="arg">name</i></a></li>
<li><a href="#7"><b class="cmd">::critcl::typeconv::arg-get-support</b> <i class="arg">name</i></a></li>
<li><a href="#8"><b class="cmd">::critcl::typeconv::result-def</b> <i class="arg">name</i> <i class="arg">body</i> <span class="opt">?<i class="arg">ctype</i>?</span></a></li>
<li><a href="#9"><b class="cmd">::critcl::typeconv::result-def</b> <i class="arg">name</i> <b class="method">=</b> <i class="arg">origname</i></a></li>
<li><a href="#10"><b class="cmd">::critcl::typeconv::result-get-type</b> <i class="arg">name</i></a></li>
<li><a href="#11"><b class="cmd">::critcl::typeconv::result-get-code</b> <i class="arg">name</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>Welcome to the <i class="term">C Runtime In Tcl</i>, <i class="term"><a href="critcl_pkg.html">CriTcl</a></i> for short, a
system to build C extension packages for Tcl on the fly, from C code
embedded within Tcl scripts, for all who wish to make their code go
faster.</p>
<p>This document is the reference manpage for the <b class="package">critcl::typeconv</b>
package. This utility package provides the commands used by the core to
manage the conversion between Tcl and C types required for the command
<b class="cmd">critcl::cproc</b> and equivalents.
Its intended audience are mainly developers wishing to write generator
packages on top of the Critcl core and needing the same sort of type
management as the core itself. It is also for developer writing Tcl
packages with embedded C code and having a need to define custom
conversions which go beyond the standard types supplied here.</p>
<p>This package resides in the Core Package Layer of CriTcl.</p>
<p><img alt="arch_core" src="../image/arch_core.png"></p>
</div>
<div id="section2" class="section"><h2><a name="section2">API</a></h2>
<dl class="definitions">
<dt><a name="1"><b class="cmd">::critcl::typeconv::arg-def</b> <i class="arg">name</i> <i class="arg">body</i> <span class="opt">?<i class="arg">ctype</i>?</span> <span class="opt">?<i class="arg">ctypefun</i>?</span></a></dt>
<dd><p>This command defines the argument type <i class="arg">name</i>, and associates it
with the C code doing the conversion (<i class="arg">body</i>) from Tcl to C
The C type of the variable to hold the conversion result is
<i class="arg">ctype</i> and the type of the function argument itself is
<i class="arg">ctypefun</i>.  Both types default to <i class="arg">name</i> if they are not
specified (or the empty string).</p>
<p>If <i class="arg">name</i> is declared already an error will be thrown.</p>
<p>The <i class="arg">body</i>'s responsibility is the conversion of a
command's Tcl_Obj* argument into a C value for the underlying
function and its storage in a helper variable.</p>
<p>The C code of <i class="arg">body</i> is guaranteed to be called inside of a
separate C code block (thus allowing the use of local variables) which
has access to the following environment:</p>
<dl class="definitions">
<dt><b class="variable">interp</b></dt>
<dd><p>A Tcl_Interp* typed C variable referencing the
                   interpreter the code is running in.</p></dd>
<dt><b class="const">@@</b></dt>
<dd><p>A placeholder for the Tcl_Obj*-valued C expression
     	    	 providing the value of the argument to convert.</p></dd>
<dt><b class="const">@A</b></dt>
<dd><p>A placeholder for the name of the C variable to store the
     	    	 converted argument into.</p></dd>
</dl>
<p>As examples here are the definitions of two standard argument types:</p>
<pre class="example">
    arg-def int {
	if (Tcl_GetIntFromObj(interp, @@, &amp;@A) != TCL_OK) return TCL_ERROR;
    }
    arg-def float {
	double t;
	if (Tcl_GetDoubleFromObj(interp, @@, &amp;t) != TCL_OK) return TCL_ERROR;
	@A = (float) t;
    }
</pre>
</dd>
<dt><a name="2"><b class="cmd">::critcl::typeconv::arg-def</b> <i class="arg">name</i> <b class="method">=</b> <i class="arg">origname</i></a></dt>
<dd><p>This form of the <b class="cmd">arg-def</b> command declares <i class="arg">name</i> as an alias
of argument type <i class="arg">origname</i>, which has to be defined already. If
this is not the case an error is thrown.</p></dd>
<dt><a name="3"><b class="cmd">::critcl::typeconv::arg-set-support</b> <i class="arg">name</i> <i class="arg">code</i></a></dt>
<dd><p>This command defines a C code fragment for the already defined
argument type <i class="arg">name</i> which will be inserted before all functions
using that type. Its purpose is the definition of any supporting C
types needed by the argument type.
If the type is used by many functions the system ensures that only the
first of the multiple insertions of the code fragment is active, and
the others disabled.</p>
<p>As example here is the definition of the standard argument type
<b class="const">list</b>, which requires a supporting structure definition.</p>
<pre class="example">
    arg-def list {
	if (Tcl_ListObjGetElements (interp, @@, &amp;(@A.c), &amp;(@A.v)) != TCL_OK) {
	    return TCL_ERROR;
        }
	@A.o = @@;
    } critcl_list critcl_list
    arg-set-support list {
	typedef struct critcl_list {
	    Tcl_Obj*  o;
	    Tcl_Obj** v;
	    int       c;
	} critcl_list;
    }
</pre>
</dd>
<dt><a name="4"><b class="cmd">::critcl::typeconv::arg-get-var-type</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C type of a C variable holding values
for the symbolic Critcl argument type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
<dt><a name="5"><b class="cmd">::critcl::typeconv::arg-get-arg-type</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C type of a formal C function
argument for values for the symbolic Critcl argument type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
<dt><a name="6"><b class="cmd">::critcl::typeconv::arg-get-conv</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C code fragment responsible for
converting from a <b class="variable">Tcl_Obj*</b> to the C type, for the symbolic
Critcl argument type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
<dt><a name="7"><b class="cmd">::critcl::typeconv::arg-get-support</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C code fragment supporting the
conversion code, for the symbolic Critcl argument type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
<dt><a name="8"><b class="cmd">::critcl::typeconv::result-def</b> <i class="arg">name</i> <i class="arg">body</i> <span class="opt">?<i class="arg">ctype</i>?</span></a></dt>
<dd><p>This command defines the result type <i class="arg">name</i>, and associates it
with the C code doing the conversion (<i class="arg">body</i>) from C to Tcl.
The C return type of the associated function, also the C type of the
result variable, is <i class="arg">ctype</i>. This type defaults to <i class="arg">name</i> if
it is not specified.</p>
<p>If <i class="arg">name</i> is declared already an error will be thrown.
<em>Attention!</em> The standard result type <b class="const">void</b> is special as
it has no accompanying result variable. This cannot be expressed
by the this extension command.</p>
<p>The <i class="arg">body</i>'s responsibility is the conversion of the
functions result into a Tcl result and a Tcl status. The first has to
be set into the interpreter we are in, and the second has to be
returned.</p>
<p>The C code of <i class="arg">body</i> is guaranteed to be called last in the
wrapper around the actual implementation of the <b class="cmd">cproc</b> in
question and has access to the following environment:</p>
<dl class="definitions">
<dt><b class="variable">interp</b></dt>
<dd><p>A Tcl_Interp* typed C variable referencing the
                   interpreter the result has to be stored into.</p></dd>
<dt><b class="variable">rv</b></dt>
<dd><p>The C variable holding the result to convert, of type
               <i class="arg">ctype</i>.</p></dd>
</dl>
<p>As examples here are the definitions of two standard result types:</p>
<pre class="example">
    result-def int {
	Tcl_SetObjResult(interp, Tcl_NewIntObj(rv));
	return TCL_OK;
    }
    result-def ok {
	/* interp result must be set by cproc body */
	return rv;
    } int
</pre>
</dd>
<dt><a name="9"><b class="cmd">::critcl::typeconv::result-def</b> <i class="arg">name</i> <b class="method">=</b> <i class="arg">origname</i></a></dt>
<dd><p>This form of the <b class="cmd">result-def</b> command declares <i class="arg">name</i> as an
alias of result type <i class="arg">origname</i>, which has to be defined
already. If this is not the case an error is thrown.</p></dd>
<dt><a name="10"><b class="cmd">::critcl::typeconv::result-get-type</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C type of a C variable holding values
for the symbolic Critcl result type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
<dt><a name="11"><b class="cmd">::critcl::typeconv::result-get-code</b> <i class="arg">name</i></a></dt>
<dd><p>This accessor command returns the C code fragment responsible for
converting from the C type to <b class="variable">Tcl_Obj*</b>, for the symbolic Critcl
result type <i class="arg">name</i>.</p>
<p>An error will be thrown if <i class="arg">name</i> is not known.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">Authors</a></h2>
<p>Andreas Kupries</p>
</div>
<div id="section4" class="section"><h2><a name="section4">Bugs, Ideas, Feedback</a></h2>
<p>This document, and the package it describes, will undoubtedly contain
bugs and other problems.
Please report such at <a href="https://github.com/andreas-kupries/critcl">https://github.com/andreas-kupries/critcl</a>.
Please also report any ideas for enhancements you may have for either
package and/or documentation.</p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../index.html#key8">C code</a>, <a href="../index.html#key3">Embedded C Code</a>, <a href="../index.html#key6">code generator</a>, <a href="../index.html#key0">compile &amp; run</a>, <a href="../index.html#key10">compiler</a>, <a href="../index.html#key1">dynamic code generation</a>, <a href="../index.html#key2">dynamic compilation</a>, <a href="../index.html#key9">generate package</a>, <a href="../index.html#key4">linker</a>, <a href="../index.html#key5">on demand compilation</a>, <a href="../index.html#key7">on-the-fly compilation</a></p>
</div>
<div id="category" class="section"><h2><a name="category">Category</a></h2>
<p>Glueing/Embedded C code</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2011-2012 Andreas Kupries</p>
</div>
</div></body></html>
